"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,r,t=require("lodash");exports.Type=void 0,(e=exports.Type||(exports.Type={})).number="number",e.string="string",e.boolean="boolean",e.null="null",e[void 0]="undefined",e.object="object",e.array="array",e.any="any",function(e){e[e.Id1=0]="Id1",e[e.Id2=1]="Id2",e[e.Id3=2]="Id3",e[e.Id4=3]="Id4"}(r||(r={}));const o=e=>{let r=exports.Type.any;const t=typeof e;return"number"===t?r=exports.Type.number:"string"===t?r=exports.Type.string:"boolean"===t?r=exports.Type.boolean:"undefined"===t?r=exports.Type.undefined:"object"===t&&(r=null===e?exports.Type.null:Array.isArray(e)?exports.Type.array:exports.Type.object),r};var p;exports.SchemaErrorType=void 0,(p=exports.SchemaErrorType||(exports.SchemaErrorType={})).key="key",p.type="type",p[void 0]="undefined";const s=(e,p,n,y)=>{const c=o(e),a=`${n}.${c}`;if(t.has(p,n)||y(p,n,r.Id1),t.has(p,a)||y(p,a,r.Id2),c===exports.Type.array){let n=[],c=[],d=!1;for(let r=0;r<e.length;r+=1)if(s(e[r],p,a,y),o(e[r])===exports.Type.object)if(d){const o=Object.keys(e[r]);c=t.intersection(c,o),n=t.concat(n,t.difference(n,o))}else c=Object.keys(e[r]),n=c,d=!0;const i=t.uniq(t.difference(n,c));for(let e=0;e<i.length;e+=1)y(p,`${a}.${exports.Type.object}.${i[e]}.${exports.Type.undefined}`,r.Id3)}else if(c===exports.Type.object){const r=Object.keys(e);for(let t=0;t<r.length;t+=1)s(e[r[t]],p,`${a}.${r[t]}`,y)}return p},n=(e,p,s,y)=>{const c=o(e),a=`${s}.${c}`,d=t.get(p,s);if(c!==exports.Type.undefined||d[exports.Type.undefined]){if(c===exports.Type.array&&d[exports.Type.array])for(let r=0;r<e.length;r+=1)n(e[r],p,a,y);else if(c===exports.Type.object&&d[exports.Type.object]){const r=Object.keys(d[exports.Type.object]);for(let t=0;t<r.length;t+=1)n(e[r[t]],p,`${a}.${r[t]}`,y)}}else y(p,s,r.Id4)},y=(e,o,p,s,n)=>{n===r.Id1?(s.push(p),e.push({key:p,type:exports.SchemaErrorType.key})):n===r.Id2?s.find((e=>0===p.indexOf(e)))||e.push({key:p,type:exports.SchemaErrorType.type}):n===r.Id3?t.has(o,p)||s.find((e=>0===p.indexOf(e)))||e.push({key:p,type:exports.SchemaErrorType.type}):n===r.Id4&&(e.find((e=>0===e.key.indexOf(p)))||e.push({key:p,type:exports.SchemaErrorType.undefined}))},c=e=>{const r={schema:{}};return s(e,r,"schema",((e,r,o)=>{((e,r,o)=>{t.set(e,r,{})})(e,r)})),r},a=(e,r)=>{const t=[],o=[];return s(r,e,"schema",((e,r,p)=>{y(t,e,r,o,p)})),n(r,e,"schema",((e,r,p)=>{y(t,e,r,o,p)})),t};var d={Type:exports.Type,identifyType:o,SchemaErrorType:exports.SchemaErrorType,makeSchema:c,checkSchema:a};exports.checkSchema=a,exports.default=d,exports.identifyType=o,exports.makeSchema=c;
